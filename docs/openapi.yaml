openapi: 3.0.3
info:
  title: EventMaster API
  description: |
    活動報名與驗票系統 Backend API

    EventMaster API provides comprehensive event registration and check-in management
    with QR code-based ticket verification. Built with FastAPI and designed for
    small to medium-scale events (<200 concurrent users).

    ## Features
    - JWT-based authentication with secure token management
    - Role-based access control (member, organizer, admin)
    - Event creation and management
    - Automated QR code ticket generation
    - Real-time check-in verification
    - Walk-in registration support
    - Paginated list endpoints for optimal performance

    ## Authentication
    使用 JWT Bearer Token 進行驗證。在 Authorization header 中傳入 token:
    ```
    Authorization: Bearer <your_jwt_token>
    ```

    ## Role-Based Access Control (RBAC)
    - **member**: 一般使用者，可報名活動、查看自己的報名與 QR Code
    - **organizer**: 主辦/櫃台人員，可查看報名名單並進行驗票
    - **admin**: 系統管理者，可建立活動與指派角色

    ## Rate Limiting
    - 100 requests per minute per authenticated user
    - 1000 requests per hour per IP address

    ## Support
    For API support, please contact support@eventmaster.com or visit our
    [support portal](https://eventmaster.com/support).

  version: 1.0.0

  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

  contact:
    name: EventMaster Team
    email: support@eventmaster.com
    url: https://eventmaster.com/support

  termsOfService: https://eventmaster.com/terms

servers:
  - url: https://api.eventmaster.com
    description: Production server
  - url: https://staging-api.eventmaster.com
    description: Staging server (for testing and QA)
  - url: http://localhost:8000
    description: Local development server

tags:
  - name: Authentication
    description: 使用者認證相關 API
  - name: Events
    description: 活動管理相關 API
  - name: Registrations
    description: 報名相關 API
  - name: Check-in
    description: 驗票與現場報到相關 API
  - name: Users
    description: 使用者管理相關 API (Admin only)

security:
  - BearerAuth: []

paths:
  # ==================== Authentication ====================
  /auth/login:
    post:
      operationId: loginUser
      tags:
        - Authentication
      summary: 使用者登入
      description: 使用 Email 與密碼進行登入，成功後回傳 JWT Access Token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: member@company.com
                password:
                  type: string
                  format: password
                  example: "password123"
            examples:
              memberLogin:
                summary: Login as member
                value:
                  email: "member@company.com"
                  password: "password123"
              organizerLogin:
                summary: Login as organizer
                value:
                  email: "org@company.com"
                  password: "password123"
              adminLogin:
                summary: Login as admin
                value:
                  email: "admin@company.com"
                  password: "password123"
      responses:
        '200':
          description: 登入成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  accessToken:
                    type: string
                    description: JWT Access Token
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
              examples:
                memberLoginSuccess:
                  summary: Member login successful
                  value:
                    user:
                      id: "550e8400-e29b-41d4-a716-446655440001"
                      email: "member@company.com"
                      displayName: "Alice Member"
                      role: "member"
                    accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDEiLCJleHAiOjE3MDg5NTM2MDAsInJvbGUiOiJtZW1iZXIifQ.abc123def456"
                organizerLoginSuccess:
                  summary: Organizer login successful
                  value:
                    user:
                      id: "550e8400-e29b-41d4-a716-446655440002"
                      email: "org@company.com"
                      displayName: "Bob Organizer"
                      role: "organizer"
                    accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDIiLCJleHAiOjE3MDg5NTM2MDAsInJvbGUiOiJvcmdhbml6ZXIifQ.def456ghi789"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /auth/me:
    get:
      operationId: getCurrentUser
      tags:
        - Authentication
      summary: 取得當前使用者資訊
      description: 根據 JWT Token 取得當前登入使用者的資訊
      responses:
        '200':
          description: 成功取得使用者資訊
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # ==================== Events ====================
  /events:
    get:
      operationId: listEvents
      tags:
        - Events
      summary: 取得活動列表
      description: 取得所有可報名的活動列表
      security:
        - BearerAuth: []
        - {}
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: 成功取得活動列表
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - total
                  - limit
                  - offset
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Event'
                  total:
                    type: integer
                    description: 總筆數 (所有頁面的總數量)
                    example: 42
                  limit:
                    type: integer
                    description: 每頁最大筆數
                    example: 20
                  offset:
                    type: integer
                    description: 跳過的筆數
                    example: 0

    post:
      operationId: createEvent
      tags:
        - Events
      summary: 建立新活動
      description: 建立新活動 (需要 Admin 或 Organizer 權限)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventCreateRequest'
            examples:
              quarterlyMeeting:
                summary: Quarterly all-hands meeting
                value:
                  title: "Q1 All-Hands Meeting"
                  description: "Company wide updates and quarterly goals review."
                  startAt: "2024-03-15T10:00:00Z"
                  endAt: "2024-03-15T12:00:00Z"
                  location: "Main Auditorium"
                  capacity: 200
              techWorkshop:
                summary: Technical workshop
                value:
                  title: "Advanced FastAPI Workshop"
                  description: "Hands-on workshop covering FastAPI best practices, async patterns, and testing strategies."
                  startAt: "2024-04-20T14:00:00Z"
                  endAt: "2024-04-20T17:00:00Z"
                  location: "Training Room B"
                  capacity: 30
      responses:
        '201':
          description: 活動建立成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
              examples:
                eventCreated:
                  summary: Event created successfully
                  value:
                    id: "a1b2c3d4-e5f6-4a5b-8c9d-1e2f3a4b5c6d"
                    organizerId: "550e8400-e29b-41d4-a716-446655440002"
                    title: "Q1 All-Hands Meeting"
                    description: "Company wide updates and quarterly goals review."
                    startAt: "2024-03-15T10:00:00Z"
                    endAt: "2024-03-15T12:00:00Z"
                    location: "Main Auditorium"
                    capacity: 200
                    registeredCount: 0
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '422':
          $ref: '#/components/responses/ValidationError'

  /events/managed:
    get:
      operationId: getManagedEvents
      tags:
        - Events
      summary: 取得自己管理的活動
      description: 取得當前使用者管理的活動 (Organizer 取得自己建立的活動，Admin 取得所有活動)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: 成功取得管理的活動列表
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - total
                  - limit
                  - offset
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Event'
                  total:
                    type: integer
                    description: 總筆數
                    example: 5
                  limit:
                    type: integer
                    description: 每頁最大筆數
                    example: 20
                  offset:
                    type: integer
                    description: 跳過的筆數
                    example: 0
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /events/{eventId}:
    get:
      operationId: getEvent
      tags:
        - Events
      summary: 取得活動詳細資訊
      description: 根據活動 ID 取得活動詳細資訊
      security:
        - BearerAuth: []
        - {}
      parameters:
        - $ref: '#/components/parameters/EventIdParam'
      responses:
        '200':
          description: 成功取得活動資訊
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '404':
          $ref: '#/components/responses/NotFoundError'

    patch:
      operationId: updateEvent
      tags:
        - Events
      summary: 更新活動資訊
      description: 更新活動資訊 (需要是活動的 Organizer 或 Admin)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/EventIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventUpdateRequest'
      responses:
        '200':
          description: 活動更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Event'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'

    delete:
      operationId: deleteEvent
      tags:
        - Events
      summary: 刪除活動
      description: 刪除活動 (需要是活動的 Organizer 或 Admin)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/EventIdParam'
      responses:
        '204':
          description: 活動刪除成功
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # ==================== Registrations ====================
  /events/{eventId}/registrations:
    post:
      operationId: registerForEvent
      tags:
        - Registrations
      summary: 報名活動
      description: 使用者報名參加指定活動 (Member 權限)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/EventIdParam'
      responses:
        '201':
          description: 報名成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Registration'
              examples:
                registrationSuccess:
                  summary: Successfully registered for event
                  value:
                    id: "f1e2d3c4-b5a6-4f5e-9d8c-7b6a5e4d3c2b"
                    eventId: "a1b2c3d4-e5f6-4a5b-8c9d-1e2f3a4b5c6d"
                    eventTitle: "Q1 All-Hands Meeting"
                    eventStartAt: "2024-03-15T10:00:00Z"
                    userId: "550e8400-e29b-41d4-a716-446655440001"
                    status: "registered"
                    qrCode: "QR-a1b2c3d4-550e8400-7f8e9d0a"
                    createdAt: "2024-03-01T08:30:00Z"
        '400':
          description: 報名失敗 (如重複報名、活動已額滿等)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                already_registered:
                  value:
                    error: Already registered
                    message: 您已經報名此活動
                event_full:
                  value:
                    error: Event full
                    message: 活動已額滿
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /events/{eventId}/attendees:
    get:
      operationId: getEventAttendees
      tags:
        - Registrations
      summary: 取得活動報名名單
      description: 取得指定活動的報名名單 (需要是活動的 Organizer 或 Admin)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/EventIdParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: 成功取得報名名單
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - total
                  - limit
                  - offset
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Attendee'
                  total:
                    type: integer
                    description: 總報名人數
                    example: 45
                  limit:
                    type: integer
                    description: 每頁最大筆數
                    example: 20
                  offset:
                    type: integer
                    description: 跳過的筆數
                    example: 0
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /me/registrations:
    get:
      operationId: getMyRegistrations
      tags:
        - Registrations
      summary: 取得我的報名紀錄
      description: 取得當前使用者的所有報名紀錄
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: 成功取得報名紀錄
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - total
                  - limit
                  - offset
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Registration'
                  total:
                    type: integer
                    description: 總報名筆數
                    example: 3
                  limit:
                    type: integer
                    description: 每頁最大筆數
                    example: 20
                  offset:
                    type: integer
                    description: 跳過的筆數
                    example: 0
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /registrations/{registrationId}:
    delete:
      operationId: cancelRegistration
      tags:
        - Registrations
      summary: 取消報名
      description: 取消指定的報名紀錄 (只能取消自己的報名，且尚未 Check-in 的票券)
      security:
        - BearerAuth: []
      parameters:
        - name: registrationId
          in: path
          required: true
          description: 報名紀錄 ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: 取消報名成功
        '400':
          description: 取消報名失敗 (如已經 Check-in)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Cannot cancel
                message: 無法取消已經 Check-in 的票券
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # ==================== Check-in / Verification ====================
  /verify:
    post:
      operationId: verifyTicket
      tags:
        - Check-in
      summary: 驗票與 Check-in
      description: 掃描或輸入 QR Code 進行驗票並標記為 Check-in (需要 Organizer 或 Admin 權限)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - qrCode
              properties:
                qrCode:
                  type: string
                  description: QR Code Token
                  example: QR-e1-u1-1234
      responses:
        '200':
          description: 驗票成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - registration
                  - message
                properties:
                  registration:
                    $ref: '#/components/schemas/Registration'
                  message:
                    type: string
                    example: "Check-in successful!"
        '400':
          description: 驗票失敗 (QR code invalid, already checked in, etc.)
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ErrorResponse'
                  - type: object
                    properties:
                      code:
                        type: string
                        enum:
                          - INVALID_QR_CODE
                          - ALREADY_CHECKED_IN
                          - TICKET_CANCELLED
              examples:
                alreadyCheckedIn:
                  summary: Ticket already checked in
                  value:
                    error: "AlreadyCheckedIn"
                    message: "此票券已經完成驗票"
                    code: "ALREADY_CHECKED_IN"
                invalidQrCode:
                  summary: Invalid QR code
                  value:
                    error: "InvalidQrCode"
                    message: "無效的 QR Code"
                    code: "INVALID_QR_CODE"
                ticketCancelled:
                  summary: Ticket was cancelled
                  value:
                    error: "TicketCancelled"
                    message: "此票券已被取消"
                    code: "TICKET_CANCELLED"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: QR Code 不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                qrCodeNotFound:
                  summary: QR code not found
                  value:
                    error: "NotFound"
                    message: "找不到此 QR Code 對應的報名紀錄"

  /walk-in:
    post:
      operationId: walkInRegistration
      tags:
        - Check-in
      summary: 現場報名與 Check-in
      description: 現場補登使用者並直接標記為 Check-in (需要 Organizer 或 Admin 權限)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - eventId
                - email
              properties:
                eventId:
                  type: string
                  format: uuid
                  description: 活動 ID
                  example: "a1b2c3d4-e5f6-4a5b-8c9d-1e2f3a4b5c6d"
                email:
                  type: string
                  format: email
                  description: 使用者 Email (若系統中不存在，將自動建立 Member 帳號)
                  example: walkin@company.com
                displayName:
                  type: string
                  description: 使用者顯示名稱 (選填，若未提供則使用 Email 前綴)
                  example: Walk-in User
      responses:
        '201':
          description: 現場報名成功
          content:
            application/json:
              schema:
                type: object
                required:
                  - registration
                  - message
                properties:
                  registration:
                    $ref: '#/components/schemas/Registration'
                  message:
                    type: string
                    example: "Walk-in registration and check-in successful!"
        '400':
          description: 現場報名失敗 (活動已額滿等)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                eventFull:
                  summary: Event is at capacity
                  value:
                    error: "EventFull"
                    message: "活動已額滿"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          description: 活動不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                eventNotFound:
                  summary: Event not found
                  value:
                    error: "NotFound"
                    message: "找不到指定的活動"

  # ==================== Users (Admin Only) ====================
  /users:
    get:
      operationId: listUsers
      tags:
        - Users
      summary: 取得所有使用者
      description: 取得系統中所有使用者清單 (需要 Admin 權限)
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/OffsetParam'
      responses:
        '200':
          description: 成功取得使用者清單
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - total
                  - limit
                  - offset
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  total:
                    type: integer
                    description: 總使用者數
                    example: 150
                  limit:
                    type: integer
                    description: 每頁最大筆數
                    example: 20
                  offset:
                    type: integer
                    description: 跳過的筆數
                    example: 0
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /users/{userId}/role:
    patch:
      operationId: updateUserRole
      tags:
        - Users
      summary: 更新使用者角色
      description: 更新指定使用者的角色 (需要 Admin 權限)
      security:
        - BearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          description: 使用者 ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  $ref: '#/components/schemas/UserRole'
      responses:
        '200':
          description: 角色更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '422':
          $ref: '#/components/responses/ValidationError'

# ==================== Components ====================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        使用 JWT Bearer Token 進行驗證
        格式: `Authorization: Bearer <token>`

  parameters:
    EventIdParam:
      name: eventId
      in: path
      required: true
      description: 活動 ID
      schema:
        type: string
        format: uuid
        example: "a1b2c3d4-e5f6-4a5b-8c9d-1e2f3a4b5c6d"

    LimitParam:
      name: limit
      in: query
      description: 每頁最大筆數
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100
      example: 20

    OffsetParam:
      name: offset
      in: query
      description: 跳過筆數 (用於分頁)
      schema:
        type: integer
        default: 0
        minimum: 0
      example: 0

  schemas:
    # ========== User Related ==========
    UserRole:
      type: string
      enum:
        - member
        - organizer
        - admin
      description: |
        使用者角色:
        - `member`: 一般會員
        - `organizer`: 主辦方/驗票人員
        - `admin`: 系統管理員

    User:
      type: object
      required:
        - id
        - email
        - displayName
        - role
      properties:
        id:
          type: string
          format: uuid
          description: 使用者 ID
          example: "550e8400-e29b-41d4-a716-446655440001"
        email:
          type: string
          format: email
          description: Email
          example: member@company.com
        displayName:
          type: string
          description: 顯示名稱
          example: Alice Member
        role:
          $ref: '#/components/schemas/UserRole'

    # ========== Event Related ==========
    Event:
      type: object
      required:
        - id
        - organizerId
        - title
        - description
        - startAt
        - endAt
        - location
        - capacity
        - registeredCount
      properties:
        id:
          type: string
          format: uuid
          description: 活動 ID
          example: "a1b2c3d4-e5f6-4a5b-8c9d-1e2f3a4b5c6d"
        organizerId:
          type: string
          format: uuid
          description: 主辦方 User ID
          example: "550e8400-e29b-41d4-a716-446655440002"
        title:
          type: string
          description: 活動標題
          example: Q1 All-Hands Meeting
        description:
          type: string
          description: 活動描述
          example: Company wide updates and quarterly goals review.
        startAt:
          type: string
          format: date-time
          description: 活動開始時間 (ISO 8601)
          example: "2023-11-15T10:00:00Z"
        endAt:
          type: string
          format: date-time
          description: 活動結束時間 (ISO 8601)
          example: "2023-11-15T12:00:00Z"
        location:
          type: string
          description: 活動地點
          example: Main Auditorium
        capacity:
          type: integer
          description: 活動容納人數
          minimum: 1
          example: 200
        registeredCount:
          type: integer
          description: 已報名人數
          minimum: 0
          example: 45

    EventCreateRequest:
      type: object
      required:
        - title
        - description
        - startAt
        - endAt
        - location
        - capacity
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
          example: Q1 All-Hands Meeting
        description:
          type: string
          minLength: 1
          maxLength: 2000
          example: Company wide updates and quarterly goals review.
        startAt:
          type: string
          format: date-time
          example: "2023-11-15T10:00:00Z"
        endAt:
          type: string
          format: date-time
          example: "2023-11-15T12:00:00Z"
        location:
          type: string
          minLength: 1
          maxLength: 200
          example: Main Auditorium
        capacity:
          type: integer
          minimum: 1
          maximum: 10000
          example: 200

    EventUpdateRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
        description:
          type: string
          minLength: 1
          maxLength: 2000
        startAt:
          type: string
          format: date-time
        endAt:
          type: string
          format: date-time
        location:
          type: string
          minLength: 1
          maxLength: 200
        capacity:
          type: integer
          minimum: 1
          maximum: 10000

    # ========== Registration Related ==========
    RegistrationStatus:
      type: string
      enum:
        - registered
        - checked_in
        - cancelled
      description: |
        報名狀態:
        - `registered`: 已報名
        - `checked_in`: 已報到/驗票
        - `cancelled`: 已取消

    Registration:
      type: object
      required:
        - id
        - eventId
        - eventTitle
        - eventStartAt
        - userId
        - status
        - qrCode
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: 報名紀錄 ID
          example: "f1e2d3c4-b5a6-4f5e-9d8c-7b6a5e4d3c2b"
        eventId:
          type: string
          format: uuid
          description: 活動 ID
          example: "a1b2c3d4-e5f6-4a5b-8c9d-1e2f3a4b5c6d"
        eventTitle:
          type: string
          description: 活動標題 (Denormalized)
          example: Q1 All-Hands Meeting
        eventStartAt:
          type: string
          format: date-time
          description: 活動開始時間 (Denormalized)
          example: "2023-11-15T10:00:00Z"
        userId:
          type: string
          format: uuid
          description: 使用者 ID
          example: "550e8400-e29b-41d4-a716-446655440001"
        status:
          $ref: '#/components/schemas/RegistrationStatus'
        qrCode:
          type: string
          description: QR Code Token (用於驗票)
          example: QR-e1-u1-1234
        createdAt:
          type: string
          format: date-time
          description: 報名時間
          example: "2023-11-10T08:30:00Z"

    Attendee:
      allOf:
        - $ref: '#/components/schemas/Registration'
        - type: object
          required:
            - userDisplayName
            - userEmail
          properties:
            userDisplayName:
              type: string
              description: 使用者顯示名稱
              example: Alice Member
            userEmail:
              type: string
              format: email
              description: 使用者 Email
              example: member@company.com

    # ========== Check-in Related ==========
    CheckInResult:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          description: 驗票是否成功
          example: true
        message:
          type: string
          description: 驗票結果訊息
          example: Check-in Successful!
        registration:
          $ref: '#/components/schemas/Registration'
          description: 報名紀錄 (驗票成功時回傳)

    # ========== Error Responses ==========
    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: 錯誤類型
          example: ValidationError
        message:
          type: string
          description: 錯誤訊息
          example: Invalid input data
        details:
          type: object
          description: 詳細錯誤資訊 (選填)
          additionalProperties: true

  responses:
    UnauthorizedError:
      description: 未認證 - Token 無效或未提供
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missingToken:
              summary: Missing authentication token
              value:
                error: Unauthorized
                message: Invalid or missing authentication token
            expiredToken:
              summary: Expired token
              value:
                error: Unauthorized
                message: Token has expired

    ForbiddenError:
      description: 權限不足 - 使用者沒有執行此操作的權限
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            insufficientPermissions:
              summary: Insufficient permissions
              value:
                error: Forbidden
                message: You do not have permission to perform this action
            wrongRole:
              summary: Wrong user role
              value:
                error: Forbidden
                message: This action requires organizer or admin role

    NotFoundError:
      description: 資源不存在
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            resourceNotFound:
              summary: Resource not found
              value:
                error: NotFound
                message: Resource not found

    ValidationError:
      description: 輸入驗證錯誤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            validationFailure:
              summary: Input validation failure
              value:
                error: ValidationError
                message: Invalid input data
                details:
                  email: Invalid email format
                  capacity: Must be greater than 0
